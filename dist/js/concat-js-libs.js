class Popbox{constructor(e={blur:!1}){if(this.currently_opened=[],"blur"in e&&e.blur){var t=document.querySelector(".popbox_main_content");t&&t.classList.add("popbox_blur")}this.bindEvents()}bindEvents(){var e=document.querySelectorAll("[data-popbox-target]"),t=document.querySelectorAll("[data-popbox-close]"),o=document.querySelectorAll("[data-popbox-id]"),s=this;if(e)for(var n=0;n<e.length;n++)e[n].addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-popbox-target");t&&s.open(t)}),!1);if(t)for(n=0;n<t.length;n++)t[n].addEventListener("click",(function(e){e.preventDefault();var t=this.getAttribute("data-popbox-close");t&&s.close(t)}),!1);if(o)for(n=0;n<o.length;n++)o[n].addEventListener("click",(function(e){e.preventDefault();var t=e.target.getAttribute("data-popbox-id");t&&s.close(t)}),!1),o[n].addEventListener(s.transition,(function(e){this.classList.contains("opened")&&!this.classList.contains("visible")&&this.classList.remove("opened")}));document.addEventListener("keyup",(function(e){s.current(!0)&&27==e.keyCode&&s.close(s.current(!0))}))}opened(e){if(e){var t=new CustomEvent("popbox_opened",{bubbles:!0,detail:{popbox:e}});e.dispatchEvent(t)}}opening(e){if(e){var t=new CustomEvent("popbox_opening",{bubbles:!0,detail:{popbox:e}});e.dispatchEvent(t)}}closing(e){if(e){var t=new CustomEvent("popbox_closing",{bubbles:!0,detail:{popbox:e}});e.dispatchEvent(t)}}closed(e){if(e){var t=new CustomEvent("popbox_closed",{bubbles:!0,detail:{popbox:e}});e.dispatchEvent(t)}}current(e=!1){if(e){var t=null;return this.currently_opened.length&&(t=this.currently_opened[this.currently_opened.length-1]),t}return this.currently_opened}add(e){var t=this.getId(e);this.remove(t),this.currently_opened.push(t)}remove(e){var t=this.getId(e),o=this.currently_opened.indexOf(t);o>-1&&this.currently_opened.splice(o,1)}zIndex(){var e,t=9999;(e=this.current(!0))&&((e=this.find(e))&&(t=parseInt(e.style.zIndex)));return t}find(e){return this.select('[data-popbox-id="'+e+'"]')}select(e){return document.querySelector(e)}clear(){for(var e=document.querySelectorAll("[data-popbox-id].opened"),t=0;t<e.length;t++)this.close(e[t]);this.currently_opened=[],this.select("html").classList.remove("popbox_locked"),this.select("html").removeAttribute("popbox")}close(e){var t=this.getId(e);(e=this.getpopbox(e))&&(this.closing(e),this.remove(t),e.classList.remove("visible"),e.style.zIndex=-999,0==this.currently_opened.length&&this.select("html").classList.remove("popbox_locked"),this.current(!0)?this.select("html").setAttribute("popbox",this.current(!0)):this.select("html").removeAttribute("popbox"),this.closed(e))}getpopbox(e){return e instanceof HTMLElement?e:this.find(e)}getId(e){return e instanceof HTMLElement?e.getAttribute("data-popbox-id"):e}open(e){var t=this.getId(e);(e=this.getpopbox(e))&&(this.opening(e),e.style.zIndex=this.zIndex()+1,e.classList.add("opened"),setTimeout((function(){e.classList.add("visible")})),this.select("html").classList.add("popbox_locked"),this.select("html").setAttribute("popbox",t),this.add(t),this.opened(e))}}